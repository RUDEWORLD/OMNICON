{% extends "base.html" %}

{% block title %}Dashboard - Omnicon Control Panel{% endblock %}

{% block content %}
<div class="row">
    <!-- System Status Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> System Status</h5>
            </div>
            <div class="card-body">
                <div id="systemInfo">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Control Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-exchange-alt"></i> Service Control</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <button class="btn btn-outline-primary w-100" id="companionBtn" onclick="toggleService('companion')">
                            <i class="fas fa-satellite-dish"></i><br>
                            Companion
                            <div id="companionStatus" class="mt-1">
                                <small class="badge bg-secondary">Checking...</small>
                            </div>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-primary w-100" id="satelliteBtn" onclick="toggleService('satellite')">
                            <i class="fas fa-satellite"></i><br>
                            Satellite
                            <div id="satelliteStatus" class="mt-1">
                                <small class="badge bg-secondary">Checking...</small>
                            </div>
                        </button>
                    </div>
                </div>
                <div class="alert alert-info mt-3 mb-0">
                    <small><i class="fas fa-info-circle"></i> Click to activate the selected service</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Network Settings Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-network-wired"></i> Network Settings</h5>
            </div>
            <div class="card-body">
                <div id="networkInfo" class="mb-3">
                    <div class="text-center">
                        <div class="spinner-border text-info" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>

                <div class="btn-group w-100 mb-3" role="group">
                    <input type="radio" class="btn-check" name="networkMode" id="dhcpMode" autocomplete="off">
                    <label class="btn btn-outline-primary" for="dhcpMode" onclick="setNetworkMode('DHCP')">
                        <i class="fas fa-magic"></i> DHCP
                    </label>

                    <input type="radio" class="btn-check" name="networkMode" id="staticMode" autocomplete="off">
                    <label class="btn btn-outline-primary" for="staticMode" onclick="setNetworkMode('STATIC')">
                        <i class="fas fa-wrench"></i> Static IP
                    </label>
                </div>

                <button class="btn btn-warning w-100" onclick="showStaticConfig()">
                    <i class="fas fa-edit"></i> Configure Static IP
                </button>
            </div>
        </div>
    </div>

    <!-- Updates Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-download"></i> Updates</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="window.location.href='/terminal'">
                        <i class="fas fa-terminal"></i> UPDATE COMPANION OR SATELLITE
                    </button>
                    <button class="btn btn-outline-success" onclick="showOmniconUpdate()">
                        <i class="fas fa-microchip"></i> Update Omnicon
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Date/Time Settings Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-clock"></i> Date & Time</h5>
            </div>
            <div class="card-body">
                <div id="dateTimeInfo" class="mb-3">
                    <p class="mb-1"><strong>Current Date:</strong> <span id="currentDate">--</span></p>
                    <p class="mb-1"><strong>Current Time:</strong> <span id="currentTime">--</span></p>
                    <p class="mb-3">
                        <strong>Timezone:</strong>
                        <span id="currentTimezone">--</span>
                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="loadDateTime()" title="Refresh timezone">
                            <i class="fas fa-sync"></i>
                        </button>
                    </p>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-secondary" onclick="showDateTimeConfig()">
                        <i class="fas fa-calendar-alt"></i> Set Date & Time
                    </button>
                    <button class="btn btn-info" onclick="showTimezoneConfig()">
                        <i class="fas fa-globe"></i> Change Timezone
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Power Control Card -->
    <div class="col-lg-6 mb-3">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-power-off"></i> Power Control</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-warning" onclick="confirmPowerAction('reboot')">
                        <i class="fas fa-redo"></i> Reboot System
                    </button>
                    <button class="btn btn-danger" onclick="confirmPowerAction('shutdown')">
                        <i class="fas fa-power-off"></i> Shutdown System
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Static IP Configuration Modal -->
<div class="modal fade" id="staticConfigModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Configure Static IP</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="staticConfigForm">
                    <div class="mb-3">
                        <label for="staticIp" class="form-label">IP Address</label>
                        <input type="text" class="form-control" id="staticIp" placeholder="192.168.0.100" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" required>
                    </div>
                    <div class="mb-3">
                        <label for="staticSubnet" class="form-label">Subnet Mask</label>
                        <input type="text" class="form-control" id="staticSubnet" placeholder="255.255.255.0" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" required>
                    </div>
                    <div class="mb-3">
                        <label for="staticGateway" class="form-label">Gateway</label>
                        <input type="text" class="form-control" id="staticGateway" placeholder="192.168.0.1" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveStaticConfig()">Apply Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Timezone Configuration Modal -->
<div class="modal fade" id="timezoneModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Change Timezone</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="timezoneSearch" class="form-label">Search Timezone</label>
                    <input type="text" class="form-control" id="timezoneSearch"
                           placeholder="Type to search (e.g., New York, London, Tokyo)">
                </div>
                <div class="mb-3">
                    <label for="timezoneSelect" class="form-label">Select Timezone</label>
                    <select class="form-control" id="timezoneSelect" size="10" style="height: 300px;">
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="alert alert-info">
                    <small><i class="fas fa-info-circle"></i> Current timezone: <strong id="modalCurrentTz">--</strong></small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveTimezone()">Apply Timezone</button>
            </div>
        </div>
    </div>
</div>

<!-- Date/Time Configuration Modal -->
<div class="modal fade" id="dateTimeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Set Date & Time</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="dateTimeForm">
                    <div class="mb-3">
                        <label for="setDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="setDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="setTime" class="form-label">Time</label>
                        <input type="time" class="form-control" id="setTime" step="1" required>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="format24hr">
                            <label class="form-check-label" for="format24hr">
                                Use 24-hour format
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveDateTime()">Apply Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Omnicon Update Modal -->
<div class="modal fade" id="omniconUpdateModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Omnicon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="updateVersionList" class="list-group">
                    <!-- Version list will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmTitle">Confirm Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="confirmBody">
                Are you sure you want to proceed?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification Container -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto" id="toastTitle">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastBody">
            Message here
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Auto-refresh functionality
let refreshInterval = null;
let autoRefreshEnabled = true;

$(document).ready(function() {
    loadSystemInfo();
    loadNetworkSettings();
    loadDateTime();

    // Set up auto-refresh with different intervals
    if (autoRefreshEnabled) {
        // Update time every second so you can see seconds change
        setInterval(function() {
            loadDateTime();
        }, 1000); // Refresh every 1 second

        // Update system info and network less frequently
        setInterval(function() {
            loadSystemInfo();
            loadNetworkSettings();
        }, 5000); // Refresh every 5 seconds
    }
});
</script>
{% endblock %}